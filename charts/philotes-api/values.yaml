# Default values for philotes-api

# Number of replicas
replicaCount: 1

image:
  repository: ghcr.io/janovincze/philotes-api
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext:
  fsGroup: 1000

securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

service:
  type: ClusterIP
  port: 8080

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: philotes.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: philotes-tls
  #    hosts:
  #      - philotes.local

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Pod Disruption Budget
pdb:
  enabled: true
  minAvailable: 1
  # maxUnavailable: 1

# Network Policy
networkPolicy:
  enabled: false
  # Additional ingress rules
  additionalIngress: []
  # Additional egress rules
  additionalEgress: []

nodeSelector: {}

tolerations: []

affinity: {}

# API Server configuration
api:
  # Environment (development, staging, production)
  env: "production"
  # Listen address
  listenAddr: ":8080"
  # Base URL for the API (used in responses)
  baseUrl: "http://localhost:8080"
  # Read timeout
  readTimeout: "15s"
  # Write timeout
  writeTimeout: "15s"
  # CORS allowed origins (comma-separated)
  corsOrigins: "*"
  # Rate limit (requests per second)
  rateLimitRPS: "100"
  # Rate limit burst
  rateLimitBurst: "200"

# Database configuration
database:
  host: "postgresql"
  port: "5432"
  name: "philotes"
  user: "philotes"
  # Password - prefer using existingSecret
  password: ""
  sslMode: "disable"
  maxOpenConns: "25"
  maxIdleConns: "5"
  # Use existing secret for password
  # Secret must have key: password
  existingSecret: ""

# Metrics configuration
metrics:
  enabled: true
  port: 9090
  # ServiceMonitor for Prometheus Operator
  serviceMonitor:
    enabled: false
    namespace: ""
    interval: "30s"
    scrapeTimeout: "10s"
    labels: {}

# Health check configuration
health:
  enabled: true
  # Liveness probe
  liveness:
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  # Readiness probe
  readiness:
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

# Alerting configuration
alerting:
  enabled: true
  evaluationInterval: "30s"
  notificationTimeout: "10s"
  prometheusUrl: "http://prometheus:9090"
  retentionDays: "30"

# Vault configuration for secrets management
vault:
  # Enable Vault integration
  enabled: false
  # Vault server address
  address: ""
  # Vault namespace (Enterprise feature, leave empty for OSS)
  namespace: ""
  # Authentication method: "kubernetes" or "token"
  authMethod: "kubernetes"
  # Vault role for Kubernetes auth
  role: "philotes"
  # Path to Kubernetes service account token
  tokenPath: "/var/run/secrets/kubernetes.io/serviceaccount/token"
  # Static token (for development only, use authMethod: "token")
  token: ""
  # Skip TLS verification (not recommended for production)
  tlsSkipVerify: "false"
  # CA certificate path for Vault TLS
  caCert: ""
  # Secret mount path in Vault
  secretMountPath: "secret"
  # Token renewal interval (matches config.go default)
  tokenRenewalInterval: "1h"
  # Secret refresh interval (matches config.go default)
  secretRefreshInterval: "5m"
  # Fall back to environment variables if Vault is unavailable
  fallbackToEnv: "true"
  # Secret paths in Vault
  secretPaths:
    # Path to buffer database credentials
    databaseBuffer: "philotes/database/buffer"
    # Path to source database credentials
    databaseSource: "philotes/database/source"
    # Path to MinIO/S3 storage credentials
    storageMinio: "philotes/storage/minio"

# Environment variables
env: []
#  - name: EXTRA_VAR
#    value: "value"

# Extra environment variables from secrets/configmaps
envFrom: []
#  - secretRef:
#      name: extra-secrets
